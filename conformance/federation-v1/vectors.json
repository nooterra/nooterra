{
  "schemaVersion": "FederationConformanceVectors.v1",
  "packVersion": "1.0.0",
  "generatedAt": "2026-02-27T00:00:00.000Z",
  "determinism": {
    "identityKeyFields": [
      "endpoint",
      "envelope.type",
      "envelope.invocationId",
      "envelope.originDid",
      "envelope.targetDid"
    ],
    "payloadHashAlgorithm": "sha256(canonicalJson(envelope))",
    "namespaceRouting": "registry_priority_then_exact_did"
  },
  "cases": [
    {
      "id": "invoke_namespace_ambiguous_fail_closed",
      "endpoint": "invoke",
      "asOf": "2026-02-27T01:00:00.000Z",
      "policy": {
        "trustedCoordinatorDids": "did:nooterra:coord_bravo,did:nooterra:coord_charlie",
        "namespaceRoutes": {},
        "namespaceAsOf": "2026-02-27T01:00:00.000Z",
        "namespaceRegistry": [
          {
            "recordId": "amb_1",
            "namespaceDid": "did:nooterra:coord_bravo",
            "ownerDid": "did:nooterra:coord_bravo",
            "routeBaseUrl": "https://bravo-a.nooterra.test",
            "priority": 50,
            "observedAt": "2026-02-27T00:00:00.000Z",
            "ttlSeconds": 86400
          },
          {
            "recordId": "amb_2",
            "namespaceDid": "did:nooterra:coord_bravo",
            "ownerDid": "did:nooterra:coord_charlie",
            "routeBaseUrl": "https://charlie.nooterra.test",
            "priority": 50,
            "observedAt": "2026-02-27T00:00:00.000Z",
            "ttlSeconds": 86400
          }
        ]
      },
      "envelope": {
        "version": "1.0",
        "type": "coordinatorInvoke",
        "invocationId": "inv_vec_namespace_ambiguous_1",
        "originDid": "did:nooterra:coord_alpha",
        "targetDid": "did:nooterra:coord_bravo",
        "capabilityId": "capability.dispatch.v1",
        "payload": {
          "op": "ping"
        }
      },
      "expected": {
        "accept": false,
        "code": "FEDERATION_NAMESPACE_ROUTE_AMBIGUOUS"
      }
    },
    {
      "id": "invoke_namespace_missing_fail_closed",
      "endpoint": "invoke",
      "envelope": {
        "version": "1.0",
        "type": "coordinatorInvoke",
        "invocationId": "inv_vec_route_missing_1",
        "originDid": "did:nooterra:coord_alpha",
        "targetDid": "did:nooterra:coord_charlie",
        "capabilityId": "capability.dispatch.v1",
        "payload": {
          "op": "ping"
        }
      },
      "expected": {
        "accept": false,
        "code": "FEDERATION_NAMESPACE_ROUTE_MISSING"
      }
    },
    {
      "id": "invoke_namespace_stale_fail_closed",
      "endpoint": "invoke",
      "asOf": "2026-02-27T01:00:00.000Z",
      "policy": {
        "trustedCoordinatorDids": "did:nooterra:coord_bravo",
        "namespaceRoutes": {},
        "namespaceAsOf": "2026-02-27T01:00:00.000Z",
        "namespaceRegistry": [
          {
            "recordId": "stale_1",
            "namespaceDid": "did:nooterra:coord_bravo",
            "ownerDid": "did:nooterra:coord_bravo",
            "routeBaseUrl": "https://bravo.nooterra.test",
            "observedAt": "2026-02-25T00:00:00.000Z",
            "ttlSeconds": 60
          }
        ]
      },
      "envelope": {
        "version": "1.0",
        "type": "coordinatorInvoke",
        "invocationId": "inv_vec_namespace_stale_1",
        "originDid": "did:nooterra:coord_alpha",
        "targetDid": "did:nooterra:coord_bravo",
        "capabilityId": "capability.dispatch.v1",
        "payload": {
          "op": "ping"
        }
      },
      "expected": {
        "accept": false,
        "code": "FEDERATION_NAMESPACE_RECORD_STALE"
      }
    },
    {
      "id": "invoke_namespace_transfer_resolved",
      "endpoint": "invoke",
      "asOf": "2026-02-27T01:00:00.000Z",
      "policy": {
        "trustedCoordinatorDids": "did:nooterra:coord_bravo,did:nooterra:coord_charlie",
        "namespaceRoutes": {},
        "namespaceAsOf": "2026-02-27T01:00:00.000Z",
        "namespaceRegistry": [
          {
            "recordId": "transfer_1",
            "namespaceDid": "did:nooterra:coord_bravo",
            "ownerDid": "did:nooterra:coord_bravo",
            "transferToDid": "did:nooterra:coord_charlie",
            "transferEffectiveAt": "2026-02-27T00:30:00.000Z",
            "routeBaseUrl": "https://charlie.nooterra.test/fed",
            "priority": 100,
            "observedAt": "2026-02-27T00:00:00.000Z",
            "ttlSeconds": 86400
          }
        ]
      },
      "envelope": {
        "version": "1.0",
        "type": "coordinatorInvoke",
        "invocationId": "inv_vec_namespace_transfer_1",
        "originDid": "did:nooterra:coord_alpha",
        "targetDid": "did:nooterra:coord_bravo",
        "capabilityId": "capability.dispatch.v1",
        "payload": {
          "op": "ping"
        }
      },
      "expected": {
        "accept": true,
        "namespaceDid": "did:nooterra:coord_bravo",
        "resolvedCoordinatorDid": "did:nooterra:coord_charlie",
        "routingReasonCode": "FEDERATION_NAMESPACE_ROUTE_RESOLVED",
        "namespaceDecisionId": "$nonEmptyString"
      }
    },
    {
      "id": "invoke_replay_duplicate_deterministic",
      "endpoint": "invoke",
      "envelope": {
        "version": "1.0",
        "type": "coordinatorInvoke",
        "invocationId": "inv_vec_replay_1",
        "originDid": "did:nooterra:coord_alpha",
        "targetDid": "did:nooterra:coord_bravo",
        "capabilityId": "capability.dispatch.v1",
        "payload": {
          "op": "ping"
        }
      },
      "expected": {
        "accept": true,
        "duplicateReplayHeader": "x-federation-replay=duplicate",
        "namespaceDecisionId": "$nonEmptyString"
      }
    },
    {
      "id": "invoke_replay_hash_conflict_fail_closed",
      "endpoint": "invoke",
      "envelope": {
        "version": "1.0",
        "type": "coordinatorInvoke",
        "invocationId": "inv_vec_replay_conflict_1",
        "originDid": "did:nooterra:coord_alpha",
        "targetDid": "did:nooterra:coord_bravo",
        "capabilityId": "capability.dispatch.v1",
        "payload": {
          "op": "ping"
        }
      },
      "mutations": [
        {
          "label": "payload_drift",
          "path": "payload.op",
          "value": "different"
        }
      ],
      "expected": {
        "accept": false,
        "code": "FEDERATION_ENVELOPE_CONFLICT"
      }
    },
    {
      "id": "invoke_untrusted_peer_fail_closed",
      "endpoint": "invoke",
      "envelope": {
        "version": "1.0",
        "type": "coordinatorInvoke",
        "invocationId": "inv_vec_untrusted_1",
        "originDid": "did:nooterra:coord_alpha",
        "targetDid": "did:nooterra:coord_unknown",
        "capabilityId": "capability.dispatch.v1",
        "payload": {
          "op": "ping"
        }
      },
      "expected": {
        "accept": false,
        "code": "FEDERATION_UNTRUSTED_COORDINATOR"
      }
    },
    {
      "id": "invoke_valid_trusted_namespace_route",
      "endpoint": "invoke",
      "envelope": {
        "version": "1.0",
        "type": "coordinatorInvoke",
        "invocationId": "inv_vec_route_1",
        "originDid": "did:nooterra:coord_alpha",
        "targetDid": "did:nooterra:coord_bravo",
        "capabilityId": "capability.dispatch.v1",
        "payload": {
          "op": "ping"
        }
      },
      "expected": {
        "accept": true,
        "namespaceDid": "did:nooterra:coord_bravo",
        "resolvedCoordinatorDid": "did:nooterra:coord_bravo",
        "routingReasonCode": "FEDERATION_NAMESPACE_ROUTE_RESOLVED",
        "namespaceDecisionId": "$nonEmptyString"
      }
    }
  ]
}
