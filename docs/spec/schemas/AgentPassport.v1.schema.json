{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://nooterra.local/schemas/AgentPassport.v1.schema.json",
  "title": "AgentPassport.v1",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schemaVersion",
    "passportId",
    "agentId",
    "tenantId",
    "principalRef",
    "identityAnchors",
    "delegationRoot",
    "policyEnvelope",
    "status",
    "createdAt",
    "updatedAt"
  ],
  "properties": {
    "schemaVersion": { "const": "AgentPassport.v1" },
    "passportId": { "type": "string", "minLength": 1, "maxLength": 200 },
    "agentId": { "type": "string", "minLength": 1, "maxLength": 200 },
    "tenantId": { "type": "string", "minLength": 1, "maxLength": 200 },
    "principalRef": {
      "type": "object",
      "additionalProperties": false,
      "required": ["principalType", "principalId"],
      "properties": {
        "principalType": {
          "type": "string",
          "enum": ["human", "business", "service", "dao"]
        },
        "principalId": { "type": "string", "minLength": 1, "maxLength": 200 },
        "jurisdiction": { "type": "string", "maxLength": 64 }
      }
    },
    "identityAnchors": {
      "type": "object",
      "additionalProperties": false,
      "required": ["jwksUri", "activeKeyId", "keysetHash"],
      "properties": {
        "did": { "type": "string", "maxLength": 512 },
        "jwksUri": { "type": "string", "format": "uri", "pattern": "^https://" },
        "activeKeyId": { "type": "string", "minLength": 1, "maxLength": 200 },
        "keysetHash": { "type": "string", "pattern": "^[0-9a-f]{64}$" }
      }
    },
    "delegationRoot": {
      "type": "object",
      "additionalProperties": false,
      "required": ["rootGrantId", "rootGrantHash", "issuedAt", "expiresAt", "revokedAt"],
      "properties": {
        "rootGrantId": { "type": "string", "minLength": 1, "maxLength": 200 },
        "rootGrantHash": { "type": "string", "pattern": "^[0-9a-f]{64}$" },
        "issuedAt": { "type": "string", "format": "date-time" },
        "expiresAt": { "type": ["string", "null"], "format": "date-time" },
        "revokedAt": { "type": ["string", "null"], "format": "date-time" }
      }
    },
    "capabilityCredentials": {
      "type": "array",
      "maxItems": 512,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["credentialType", "issuer", "credentialRef", "credentialHash", "issuedAt", "expiresAt"],
        "properties": {
          "credentialType": { "type": "string", "minLength": 1, "maxLength": 120 },
          "issuer": { "type": "string", "minLength": 1, "maxLength": 200 },
          "credentialRef": { "type": "string", "minLength": 1, "maxLength": 512 },
          "credentialHash": { "type": "string", "pattern": "^[0-9a-f]{64}$" },
          "issuedAt": { "type": "string", "format": "date-time" },
          "expiresAt": { "type": ["string", "null"], "format": "date-time" }
        }
      }
    },
    "policyEnvelope": {
      "type": "object",
      "additionalProperties": false,
      "required": ["maxPerCallCents", "maxDailyCents", "allowedRiskClasses", "requireApprovalAboveCents"],
      "properties": {
        "maxPerCallCents": { "type": "integer", "minimum": 0 },
        "maxDailyCents": { "type": "integer", "minimum": 0 },
        "allowedRiskClasses": {
          "type": "array",
          "minItems": 1,
          "uniqueItems": true,
          "items": {
            "type": "string",
            "enum": ["read", "compute", "action", "financial"]
          }
        },
        "requireApprovalAboveCents": { "type": ["integer", "null"], "minimum": 0 },
        "allowlistRefs": {
          "type": "array",
          "items": { "type": "string", "minLength": 1, "maxLength": 200 }
        }
      }
    },
    "status": {
      "type": "string",
      "enum": ["active", "suspended", "revoked"]
    },
    "metadata": {
      "type": "object",
      "additionalProperties": true
    },
    "createdAt": { "type": "string", "format": "date-time" },
    "updatedAt": { "type": "string", "format": "date-time" }
  }
}
