{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://nooterra.local/schemas/ReputationEvent.v1.schema.json",
  "title": "ReputationEvent.v1",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schemaVersion",
    "artifactType",
    "artifactId",
    "eventId",
    "tenantId",
    "occurredAt",
    "eventKind",
    "subject",
    "sourceRef",
    "facts",
    "eventHash"
  ],
  "properties": {
    "schemaVersion": { "const": "ReputationEvent.v1" },
    "artifactType": { "const": "ReputationEvent.v1" },
    "artifactId": {
      "type": "string",
      "minLength": 3,
      "maxLength": 240,
      "pattern": "^[A-Za-z0-9:_-]+$"
    },
    "eventId": {
      "type": "string",
      "minLength": 3,
      "maxLength": 240,
      "pattern": "^[A-Za-z0-9:_-]+$"
    },
    "tenantId": {
      "type": "string",
      "minLength": 1,
      "maxLength": 128,
      "pattern": "^[A-Za-z0-9:_-]+$"
    },
    "occurredAt": { "type": "string", "format": "date-time" },
    "eventKind": {
      "type": "string",
      "enum": [
        "decision_approved",
        "decision_rejected",
        "holdback_auto_released",
        "dispute_opened",
        "verdict_issued",
        "adjustment_applied",
        "penalty_dispute_lost",
        "penalty_chargeback",
        "penalty_invalid_signature",
        "penalty_sybil"
      ]
    },
    "subject": {
      "type": "object",
      "additionalProperties": false,
      "required": ["agentId"],
      "properties": {
        "agentId": {
          "type": "string",
          "minLength": 3,
          "maxLength": 128,
          "pattern": "^[A-Za-z0-9:_-]+$"
        },
        "toolId": {
          "type": "string",
          "minLength": 1,
          "maxLength": 200,
          "pattern": "^[A-Za-z0-9:_-]+$"
        },
        "counterpartyAgentId": {
          "type": "string",
          "minLength": 3,
          "maxLength": 128,
          "pattern": "^[A-Za-z0-9:_-]+$"
        },
        "role": {
          "type": "string",
          "enum": ["payee", "payer", "arbiter", "system"]
        }
      }
    },
    "sourceRef": {
      "type": "object",
      "additionalProperties": false,
      "required": ["kind"],
      "properties": {
        "kind": {
          "type": "string",
          "minLength": 2,
          "maxLength": 64,
          "pattern": "^[A-Za-z0-9:_-]+$"
        },
        "artifactId": {
          "type": "string",
          "minLength": 3,
          "maxLength": 240,
          "pattern": "^[A-Za-z0-9:_-]+$"
        },
        "sourceId": {
          "type": "string",
          "minLength": 3,
          "maxLength": 240,
          "pattern": "^[A-Za-z0-9:_-]+$"
        },
        "hash": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
        "agreementHash": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
        "receiptHash": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
        "holdHash": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
        "decisionHash": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
        "verdictHash": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
        "runId": {
          "type": "string",
          "minLength": 3,
          "maxLength": 128,
          "pattern": "^[A-Za-z0-9:_-]+$"
        },
        "settlementId": {
          "type": "string",
          "minLength": 3,
          "maxLength": 240,
          "pattern": "^[A-Za-z0-9:_-]+$"
        },
        "disputeId": {
          "type": "string",
          "minLength": 3,
          "maxLength": 240,
          "pattern": "^[A-Za-z0-9:_-]+$"
        },
        "caseId": {
          "type": "string",
          "minLength": 3,
          "maxLength": 240,
          "pattern": "^[A-Za-z0-9:_-]+$"
        },
        "adjustmentId": {
          "type": "string",
          "minLength": 3,
          "maxLength": 240,
          "pattern": "^[A-Za-z0-9:_-]+$"
        }
      },
      "anyOf": [
        { "required": ["artifactId"] },
        { "required": ["sourceId"] },
        { "required": ["hash"] },
        { "required": ["agreementHash"] },
        { "required": ["receiptHash"] },
        { "required": ["holdHash"] },
        { "required": ["decisionHash"] },
        { "required": ["verdictHash"] },
        { "required": ["runId"] },
        { "required": ["settlementId"] },
        { "required": ["disputeId"] },
        { "required": ["caseId"] },
        { "required": ["adjustmentId"] }
      ]
    },
    "facts": {
      "type": "object",
      "additionalProperties": true
    },
    "eventHash": { "type": "string", "pattern": "^[a-f0-9]{64}$" }
  }
}
