{
  "schemaVersion": "FixtureMatrix.v1",
  "root": "test/fixtures/bundles/v1",
  "trust": "test/fixtures/bundles/v1/trust.json",
  "fixtures": [
    {
      "id": "jobproof_strict_pass",
      "kind": "job-proof",
      "path": "jobproof/strict-pass",
      "strict": true,
      "expected": { "exitCode": 0, "ok": true, "verificationOk": true, "errorCodes": [], "warningCodes": [] }
    },
    {
      "id": "jobproof_strict_fail_missing_verification_report",
      "kind": "job-proof",
      "path": "jobproof/strict-fail-missing-verification-report",
      "strict": true,
      "expected": {
        "exitCode": 1,
        "ok": false,
        "verificationOk": false,
        "errorCodes": ["missing verify/verification_report.json"],
        "warningCodes": []
      }
    },
    {
      "id": "jobproof_nonstrict_pass_missing_verification_report",
      "kind": "job-proof",
      "path": "jobproof/nonstrict-pass-missing-verification-report",
      "strict": false,
      "expected": { "exitCode": 0, "ok": true, "verificationOk": true, "errorCodes": [], "warningCodes": ["VERIFICATION_REPORT_MISSING_LENIENT"] }
    },
    {
      "id": "jobproof_strict_fail_manifest_tamper",
      "kind": "job-proof",
      "path": "jobproof/strict-fail-manifest-tamper",
      "strict": true,
      "expected": { "exitCode": 1, "ok": false, "verificationOk": false, "errorCodes": ["sha256 mismatch"], "warningCodes": [] }
    },
    {
      "id": "jobproof_strict_fail_report_binding_mismatch",
      "kind": "job-proof",
      "path": "jobproof/strict-fail-verification-report-binding-mismatch",
      "strict": true,
      "expected": {
        "exitCode": 1,
        "ok": false,
        "verificationOk": false,
        "errorCodes": ["verification report bundleHeadAttestation.attestationHash mismatch"],
        "warningCodes": []
      }
    },
    {
      "id": "jobproof_strict_fail_unauthorized_signer",
      "kind": "job-proof",
      "path": "jobproof/strict-fail-unauthorized-signer",
      "strict": true,
      "expected": { "exitCode": 1, "ok": false, "verificationOk": false, "errorCodes": ["signer keyId not allowed by policy"], "warningCodes": [] }
    },
    {
      "id": "jobproof_strict_fail_revoked_at_or_after_with_timeproof",
      "kind": "job-proof",
      "path": "jobproof/strict-fail-revoked-at-or-after-with-timeproof",
      "strict": true,
      "needsTrustedTimeAuthorities": true,
      "expected": { "exitCode": 1, "ok": false, "verificationOk": false, "errorCodes": ["SIGNER_REVOKED"], "warningCodes": [] }
    },
    {
      "id": "jobproof_strict_fail_revoked_before_without_timeproof",
      "kind": "job-proof",
      "path": "jobproof/strict-fail-revoked-before-without-timeproof",
      "strict": true,
      "expected": { "exitCode": 1, "ok": false, "verificationOk": false, "errorCodes": ["SIGNING_TIME_UNPROVABLE"], "warningCodes": [] }
    },
    {
      "id": "monthproof_strict_pass",
      "kind": "month-proof",
      "path": "monthproof/strict-pass",
      "strict": true,
      "expected": { "exitCode": 0, "ok": true, "verificationOk": true, "errorCodes": [], "warningCodes": [] }
    },
    {
      "id": "monthproof_strict_fail_missing_verification_report",
      "kind": "month-proof",
      "path": "monthproof/strict-fail-missing-verification-report",
      "strict": true,
      "expected": {
        "exitCode": 1,
        "ok": false,
        "verificationOk": false,
        "errorCodes": ["missing verify/verification_report.json"],
        "warningCodes": []
      }
    },
    {
      "id": "monthproof_strict_fail_manifest_tamper",
      "kind": "month-proof",
      "path": "monthproof/strict-fail-manifest-tamper",
      "strict": true,
      "expected": { "exitCode": 1, "ok": false, "verificationOk": false, "errorCodes": ["sha256 mismatch"], "warningCodes": [] }
    },
    {
      "id": "monthproof_strict_fail_unauthorized_signer",
      "kind": "month-proof",
      "path": "monthproof/strict-fail-unauthorized-signer",
      "strict": true,
      "expected": { "exitCode": 1, "ok": false, "verificationOk": false, "errorCodes": ["signer keyId not allowed by policy"], "warningCodes": [] }
    },
    {
      "id": "monthproof_nonstrict_pass_missing_verification_report",
      "kind": "month-proof",
      "path": "monthproof/nonstrict-pass-missing-verification-report",
      "strict": false,
      "expected": { "exitCode": 0, "ok": true, "verificationOk": true, "errorCodes": [], "warningCodes": ["VERIFICATION_REPORT_MISSING_LENIENT"] }
    },
    {
      "id": "financepack_strict_pass",
      "kind": "finance-pack",
      "path": "financepack/strict-pass",
      "strict": true,
      "expected": { "exitCode": 0, "ok": true, "verificationOk": true, "errorCodes": [], "warningCodes": [] }
    },
    {
      "id": "financepack_strict_fail_missing_verification_report",
      "kind": "finance-pack",
      "path": "financepack/strict-fail-missing-verification-report",
      "strict": true,
      "expected": {
        "exitCode": 1,
        "ok": false,
        "verificationOk": false,
        "errorCodes": ["missing verify/verification_report.json"],
        "warningCodes": []
      }
    },
    {
      "id": "financepack_strict_fail_manifest_tamper",
      "kind": "finance-pack",
      "path": "financepack/strict-fail-manifest-tamper",
      "strict": true,
      "expected": { "exitCode": 1, "ok": false, "verificationOk": false, "errorCodes": ["sha256 mismatch"], "warningCodes": [] }
    },
    {
      "id": "financepack_nonstrict_pass_missing_verification_report",
      "kind": "finance-pack",
      "path": "financepack/nonstrict-pass-missing-verification-report",
      "strict": false,
      "expected": { "exitCode": 0, "ok": true, "verificationOk": true, "errorCodes": [], "warningCodes": ["VERIFICATION_REPORT_MISSING_LENIENT"] }
    },
    {
      "id": "financepack_strict_pass_tool_version_unknown_warning",
      "kind": "finance-pack",
      "path": "financepack/pass-with-tool-version-unknown-warning",
      "strict": true,
      "expected": { "exitCode": 0, "ok": true, "verificationOk": true, "errorCodes": [], "warningCodes": ["TOOL_VERSION_UNKNOWN"] }
    },
    {
      "id": "financepack_strict_pass_tool_commit_unknown_warning",
      "kind": "finance-pack",
      "path": "financepack/pass-with-tool-commit-unknown-warning",
      "strict": true,
      "expected": { "exitCode": 0, "ok": true, "verificationOk": true, "errorCodes": [], "warningCodes": ["TOOL_COMMIT_UNKNOWN"] }
    },
    {
      "id": "financepack_strict_fail_on_warnings_tool_version_unknown",
      "kind": "finance-pack",
      "path": "financepack/pass-with-tool-version-unknown-warning",
      "strict": true,
      "failOnWarnings": true,
      "expected": { "exitCode": 1, "ok": false, "verificationOk": true, "errorCodes": ["FAIL_ON_WARNINGS"], "warningCodes": ["TOOL_VERSION_UNKNOWN"] }
    },
    {
      "id": "financepack_strict_fail_on_warnings_tool_commit_unknown",
      "kind": "finance-pack",
      "path": "financepack/pass-with-tool-commit-unknown-warning",
      "strict": true,
      "failOnWarnings": true,
      "expected": { "exitCode": 1, "ok": false, "verificationOk": true, "errorCodes": ["FAIL_ON_WARNINGS"], "warningCodes": ["TOOL_COMMIT_UNKNOWN"] }
    },
    {
      "id": "invoicebundle_strict_pass",
      "kind": "invoice-bundle",
      "path": "invoicebundle/strict-pass",
      "strict": true,
      "expected": { "exitCode": 0, "ok": true, "verificationOk": true, "errorCodes": [], "warningCodes": [] }
    },
    {
      "id": "invoicebundle_strict_fail_missing_pricing_matrix_signature",
      "kind": "invoice-bundle",
      "path": "invoicebundle/strict-fail-missing-pricing-matrix-signature",
      "strict": true,
      "expected": {
        "exitCode": 1,
        "ok": false,
        "verificationOk": false,
        "errorCodes": ["PRICING_MATRIX_SIGNATURE_MISSING"],
        "warningCodes": []
      }
    },
    {
      "id": "invoicebundle_nonstrict_pass_unsigned_pricing_matrix_warning",
      "kind": "invoice-bundle",
      "path": "invoicebundle/nonstrict-pass-unsigned-pricing-matrix-warning",
      "strict": false,
      "expected": { "exitCode": 0, "ok": true, "verificationOk": true, "errorCodes": [], "warningCodes": ["PRICING_MATRIX_UNSIGNED_LENIENT"] }
    },
    {
      "id": "invoicebundle_strict_fail_invalid_pricing_matrix_signature",
      "kind": "invoice-bundle",
      "path": "invoicebundle/strict-fail-invalid-pricing-matrix-signature",
      "strict": true,
      "expected": {
        "exitCode": 1,
        "ok": false,
        "verificationOk": false,
        "errorCodes": ["PRICING_MATRIX_SIGNATURE_INVALID"],
        "warningCodes": []
      }
    },
    {
      "id": "invoicebundle_strict_fail_pricing_matrix_signature_payload_mismatch",
      "kind": "invoice-bundle",
      "path": "invoicebundle/strict-fail-pricing-altered",
      "strict": true,
      "expected": {
        "exitCode": 1,
        "ok": false,
        "verificationOk": false,
        "errorCodes": ["PRICING_MATRIX_SIGNATURE_PAYLOAD_MISMATCH"],
        "warningCodes": []
      }
    },
    {
      "id": "invoicebundle_strict_fail_missing_verification_report",
      "kind": "invoice-bundle",
      "path": "invoicebundle/strict-fail-missing-verification-report",
      "strict": true,
      "expected": {
        "exitCode": 1,
        "ok": false,
        "verificationOk": false,
        "errorCodes": ["missing verify/verification_report.json"],
        "warningCodes": []
      }
    },
    {
      "id": "invoicebundle_nonstrict_pass_missing_verification_report",
      "kind": "invoice-bundle",
      "path": "invoicebundle/nonstrict-pass-missing-verification-report",
      "strict": false,
      "expected": { "exitCode": 0, "ok": true, "verificationOk": true, "errorCodes": [], "warningCodes": ["VERIFICATION_REPORT_MISSING_LENIENT"] }
    },
    {
      "id": "invoicebundle_nonstrict_pass_missing_trusted_governance_roots",
      "kind": "invoice-bundle",
      "path": "invoicebundle/strict-pass",
      "strict": false,
      "envOverrides": { "NOOTERRA_TRUSTED_GOVERNANCE_ROOT_KEYS_JSON": "" },
      "expected": {
        "exitCode": 0,
        "ok": true,
        "verificationOk": true,
        "errorCodes": [],
        "warningCodes": ["TRUSTED_GOVERNANCE_ROOT_KEYS_MISSING_LENIENT"]
      }
    },
    {
      "id": "invoicebundle_strict_fail_invoice_total_mismatch",
      "kind": "invoice-bundle",
      "path": "invoicebundle/strict-fail-invoice-total-mismatch",
      "strict": true,
      "expected": {
        "exitCode": 1,
        "ok": false,
        "verificationOk": false,
        "errorCodes": ["invoiceClaim totalCents mismatch"],
        "warningCodes": []
      }
    },
    {
      "id": "invoicebundle_strict_fail_evidence_sha_mismatch",
      "kind": "invoice-bundle",
      "path": "invoicebundle/strict-fail-evidence-sha-mismatch",
      "strict": true,
      "expected": {
        "exitCode": 1,
        "ok": false,
        "verificationOk": false,
        "errorCodes": ["metering evidenceRef sha256 mismatch"],
        "warningCodes": []
      }
    },
    {
      "id": "invoicebundle_strict_fail_pricing_code_unknown",
      "kind": "invoice-bundle",
      "path": "invoicebundle/strict-fail-pricing-code-unknown",
      "strict": true,
      "expected": {
        "exitCode": 1,
        "ok": false,
        "verificationOk": false,
        "errorCodes": ["invoice pricing code unknown"],
        "warningCodes": []
      }
    },
    {
      "id": "closepack_strict_pass",
      "kind": "close-pack",
      "path": "closepack/strict-pass",
      "strict": true,
      "expected": { "exitCode": 0, "ok": true, "verificationOk": true, "errorCodes": [], "warningCodes": [] }
    },
    {
      "id": "closepack_strict_fail_evidence_index_mismatch",
      "kind": "close-pack",
      "path": "closepack/strict-fail-evidence-index-mismatch",
      "strict": true,
      "expected": { "exitCode": 1, "ok": false, "verificationOk": false, "errorCodes": ["closepack evidence_index mismatch"], "warningCodes": [] }
    },
    {
      "id": "closepack_strict_fail_embedded_invoice_fails",
      "kind": "close-pack",
      "path": "closepack/strict-fail-embedded-invoice-fails",
      "strict": true,
      "expected": { "exitCode": 1, "ok": false, "verificationOk": false, "errorCodes": ["invoiceClaim totalCents mismatch"], "warningCodes": [] }
    },
    {
      "id": "closepack_nonstrict_pass_missing_sla_acceptance",
      "kind": "close-pack",
      "path": "closepack/nonstrict-pass-missing-sla-acceptance",
      "strict": false,
      "expected": {
        "exitCode": 0,
        "ok": true,
        "verificationOk": true,
        "errorCodes": [],
        "warningCodes": ["CLOSE_PACK_ACCEPTANCE_SURFACES_MISSING_LENIENT", "CLOSE_PACK_SLA_SURFACES_MISSING_LENIENT"]
      }
    },
    {
      "id": "jobproof_strict_fail_missing_trusted_governance_roots",
      "kind": "job-proof",
      "path": "jobproof/strict-pass",
      "strict": true,
      "envOverrides": { "NOOTERRA_TRUSTED_GOVERNANCE_ROOT_KEYS_JSON": "" },
      "expected": { "exitCode": 1, "ok": false, "verificationOk": false, "errorCodes": ["strict requires trusted governance root keys"], "warningCodes": [] }
    },
    {
      "id": "jobproof_strict_fail_wrong_trusted_governance_roots",
      "kind": "job-proof",
      "path": "jobproof/strict-pass",
      "strict": true,
      "envOverrides": { "NOOTERRA_TRUSTED_GOVERNANCE_ROOT_KEYS_JSON": "{\"key_fake\":\"x\"}" },
      "expected": { "exitCode": 1, "ok": false, "verificationOk": false, "errorCodes": ["governance policy signerKeyId not trusted"], "warningCodes": [] }
    }
  ]
}
